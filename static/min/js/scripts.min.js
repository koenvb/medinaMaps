function initialize(){var e=new google.maps.LatLng(51.210211,3.385516),t={zoom:10,center:e,scrollwheel:!0,mapTypeId:google.maps.MapTypeId.ROADMAP};map=new google.maps.Map(document.getElementById("map-canvas"),t),panorama=map.getStreetView(),panorama.setPosition(e),panorama.setPov({heading:265,pitch:0});var n="/p/img/home_marker.png",r=new google.maps.Marker({position:e,map:map,title:"Home",icon:n});content=['<div id="infoWindow"><ul><li><strong>Thuis</strong></li><li><a href="#" onclick="toggleStreetView();">Show streetview</a></li></ul><button class="button" id="selectStart">Kies als startpunt</button></div>'].join("<br>"),addInfoWindow(r,content),startPoint=r,bounds.extend(r.position),directionsService=new google.maps.DirectionsService,directionDisplay=new google.maps.DirectionsRenderer({suppressMarkers:!0,preserveViewport:!0}),directionDisplay.setMap(map)}function toggleStreetView(){var e=panorama.getVisible();e==0?panorama.setVisible(!0):panorama.setVisible(!1)}function displayMap(){$("#map-canvas").removeClass("hidden"),google.maps.event.trigger(map,"resize")}function filterAdobePDFpaste(e){var t=new Array,n=new Array,r=new RegExp,i=new RegExp,s=new RegExp,o=new RegExp,u=new RegExp;r=/^([A-Z'.* ]{2,} ){2,}[A-Z]{1,}/,i=/\d{4}/,s=/(N - Nuchter)+/,o=/(NN - Niet nuchter)+/,u=/(DC - Dagcurve)+/,t=e.split("\n");for(var a=0;a<t.length;a++){temp=t[a];if(r.test(temp)&&i.test(temp)){temp=temp.replace(/BSN.*/g,"");var f=temp.match(/^([A-Z'*.]{2,} ){1,}[A-Z]{2,}/)[0];temp=temp.replace(/^([A-Z'*.]{2,} ){1,}[A-Z]{2,}/,"");var l=$.trim(temp.match(/^( [A-Z'*.]{1} )/)[0]);temp=temp.replace(/^( [A-Z'*.]{1} )/,"");var c="unknown";o.test(temp)?c="Niet nuchter":s.test(temp)?c="Nuchter":u.test(temp)?c="Dagcurve":c="unknown";var h=$.trim(temp.match(/^.*[0-9]{4}.[\w-]{2,40}/gm)),p={name:f+"",address:h+"",gender:l+"",status:c+"",location:[],marker:[]};n.push(p)}}return n}function generateTable(e){var t=$("<table></table>").addClass("table table-striped table-bordered table-hover table-condensed");t.append("<thead><tr><th>Nr</th><th>Naam</th><th>Adres</th><th>Status</th><tr><thead>");for(var n=0;n<e.length;n++){var r=$("<tr></tr>"),i=$("<td></td>").text(n+1+""),s=$("<td></td>").text(e[n].name),o=$("<td></td>").text(e[n].address),u=$("<td></td>").text(e[n].status);r.attr("id",""+n),e[n]["status"]=="Nuchter"?r.addClass("error"):e[n]["status"]=="Dagcurve"&&r.addClass("info"),r.append(i,s,o,u),t.append(r)}$("#tableOverview").append(t),$("#tableOverview tr").click(function(){var e=patients[this.id].marker[0],t=this.id;content=['<div id="infoWindow"><ul><li><strong>'+patients[t].name+"</strong></li>"+"<li>Adres: "+patients[t].address+"</li>"+"<li>Status: "+patients[t].status+"</li>"+'<li><a href="#" onclick="toggleStreetView();">Show streetview</a></li></ul>'+'<button class="button" id="selectStart">Kies als startpunt</button></div>'].join("<br>"),panorama.setPosition(e.position),infowindow.setContent(content),infowindow.open(map,e)})}function doGeocode(e,t){var n=new google.maps.Geocoder,r=[];n.geocode({address:e},function(n,r){if(r==google.maps.GeocoderStatus.OK){var s=n[0].geometry.location;map.setCenter(n[0].geometry.location),patients[t].location=[s.lat(),s.lng()];var o=new google.maps.LatLng(patients[t].location[0],patients[t].location[1]),u=new google.maps.Marker({position:o,map:map,title:""+patients[t].name});patients[t]["status"]=="Niet nuchter"?u.setIcon("http://maps.google.com/mapfiles/ms/icons/green-dot.png"):patients[t]["status"]=="Nuchter"?u.setIcon("http://maps.google.com/mapfiles/ms/icons/red-dot.png"):patients[t]["status"]=="Dagcurve"&&u.setIcon("http://maps.google.com/mapfiles/ms/icons/blue-dot.png"),content=['<div id="infoWindow"><ul><li><strong>'+patients[t].name+"</strong></li>"+"<li>Adres: "+patients[t].address+"</li>"+"<li>Status: "+patients[t].status+"</li>"+'<li><a href="#" onclick="toggleStreetView();">Show streetview</a></li></ul>'+'<button class="button" id="selectStart">Kies als startpunt</button></div>'].join("<br>"),addInfoWindow(u,content),patients[t].marker.push(u),bounds.extend(u.position),address_count++,address_count==patients.length&&afterGeocodingStuff()}else r==google.maps.GeocoderStatus.OVER_QUERY_LIMIT?setTimeout(function(){doGeocode(e,t)},timeout):alert("Geocode was not successful for the following reason: "+r)})}function recalcRoute(){if(startPoint!=0&&endPoint!=0){var e={origin:startPoint.getPosition(),destination:endPoint.getPosition(),travelMode:google.maps.TravelMode.DRIVING,unitSystem:google.maps.UnitSystem.METRIC};directionsService.route(e,function(e,t){if(t==google.maps.DirectionsStatus.OK){$("#route-details").parent().fadeIn(),directionDisplay.setDirections(e);var n=document.getElementById("route-details");n.innerHTML="Van: ",n.innerHTML+=startPoint.title+"<br>",n.innerHTML+="Naar: "+endPoint.title+"<br>",n.innerHTML+="Afstand: "+e.routes[0].legs[0].distance.text+"<br>",n.innerHTML+="Tijd: "+e.routes[0].legs[0].duration.text+"<br><br>",directionDisplay.setMap(map)}})}else directionDisplay.setMap(null)}function addInfoWindow(e,t){google.maps.event.addListener(e,"click",function(){endPoint=e,recalcRoute(),panorama.setPosition(e.getPosition()),infowindow.setContent(t),infowindow.open(map,e)})}function afterGeocodingStuff(){map.fitBounds(bounds)}(function(){window.LOG=function(){return typeof console!="undefined"&&console!==null?typeof console.log=="function"?console.log.apply(console,arguments):void 0:void 0},window.init_loading_button=function(){return $("body").on("click",".btn-loading",function(){return $(this).button("loading")})},window.service_call=function(e,t,n,r,i){var s,o;i=i||r||n,r=r||n,arguments.length===4&&(r=void 0),arguments.length===3&&(n=void 0,r=void 0),n=n||{};for(s in n)o=n[s],o==null&&delete n[s];return $.ajax({type:e,url:t+"?"+$.param(n),contentType:"application/json",accepts:"application/json",dataType:"json",data:r?JSON.stringify(r):void 0,success:function(t){var n;return t.status==="success"?(n=void 0,t.more_url&&(n=function(n){return service_call(e,t.more_url,{},n)}),typeof i=="function"?i(void 0,t.result,n):void 0):typeof i=="function"?i(t):void 0},error:function(e,t,n){var r,s;s={error_code:"ajax_error",text_status:t,error_thrown:n,jqXHR:e};try{e.responseText&&(s=$.parseJSON(e.responseText))}catch(o){r=o,s=s}return LOG("service_call error",s),typeof i=="function"?i(s):void 0}})},$(function(){return LOG("app init")}),$(function(){return $("html.welcome").each(function(){return LOG("init welcome")})}),$(function(){return $("html.profile").each(function(){return init_profile()})}),$(function(){return $("html.feedback").each(function(){return init_loading_button()})}),$(function(){return $("html.admin-config").each(function(){return init_admin_config()})}),window.init_profile=function(){return init_loading_button()},window.init_admin_config=function(){return init_loading_button()}}).call(this);var map=null,panorama=null,directionService=null,directionDisplay=null,startPoint=!1,endPoint=!1,bounds=new google.maps.LatLngBounds,address_count=0;infowindow=new google.maps.InfoWindow;var patients=[],timeout=1;google.maps.event.addDomListener(window,"load",initialize),$(window).resize(function(){window.console&&console.log("resize");var e=$(window).width(),t=100,n=$(window).height(),r=150;window.console&&console.log(n),$("#map-canvas").css("height",n-r)}).resize(),$("#editor-btn").click(function(){window.console&&console.log("btnclicked"),$("#inputForm").toggle()}),$("#submit").click(function(e){e.preventDefault();var t=$("#txtinput").val();patients=filterAdobePDFpaste(t),window.console&&console.log(patients);for(i=0;i<patients.length;i++){currAddress=patients[i].address;var n;doGeocode(currAddress,i)}$("#inputForm").toggle(),generateTable(patients),displayMap()}),$("#tableOverview tr td").text,google.maps.event.addListener(infowindow,"domready",function(){$("#infoWindow button").on("click",function(){console.log(infowindow.anchor.position),$(this).attr("id")=="selectStart"&&(startPoint=infowindow.anchor,endPoint=!1),recalcRoute()})});